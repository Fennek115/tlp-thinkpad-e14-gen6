# ==============================================================================
# TLP Drop-in Configuration: Power-Saver Mode (Ultra Ahorro)
# ==============================================================================
# Archivo: /etc/tlp.d/30-ultra-powersave.conf
# Propósito: Configuración para máxima duración de batería
# Versión: 2.0 - Actualizada con parámetros completos según TLP 1.9.1
# Última modificación: 2026-02-16
# ==============================================================================
#
# Este archivo define el perfil de ultra-ahorro (SAV - power-saver).
# Este perfil NO se activa automáticamente. Debes activarlo manualmente
# cuando necesites exprimir cada minuto posible de tu batería.
#
# Para activarlo manualmente:
#   sudo tlp power-saver
#
# Para volver al modo automático (AC/BAT según la fuente de energía):
#   sudo tlp start
#
# Casos de uso típicos:
#   - Estás en un vuelo largo sin acceso a electricidad
#   - Estás en una reunión larga y te queda poca batería
#   - Necesitas que la laptop dure lo máximo posible para una tarea específica
#   - Estás trabajando en modo "supervivencia de batería"
#
# ==============================================================================

# ------------------------------------------------------------------------------
# CPU: Máximo Ahorro de Energía
# ------------------------------------------------------------------------------

# Política de energía (EPP)
# Usamos "power" que es la política más agresiva de ahorro. El CPU
# preferirá voltajes y frecuencias mínimas siempre que sea posible.
# El sistema se sentirá notablemente más lento, pero la batería durará
# significativamente más.
CPU_ENERGY_PERF_POLICY_ON_SAV=power

# Límites de rendimiento
# Limitamos al 40% del rendimiento máximo. Esto mantiene el CPU en
# frecuencias bajas (típicamente 0.8-1.8 GHz) la mayor parte del tiempo.
# El sistema será más lento, pero si solo estás tomando notas, leyendo
# documentos, o escribiendo, seguirá siendo perfectamente usable.
CPU_MIN_PERF_ON_SAV=0
CPU_MAX_PERF_ON_SAV=40

# Turbo Boost
# Completamente deshabilitado. El turbo boost es el enemigo número uno
# de la duración de batería. Sin él, el CPU se mantiene en sus frecuencias
# más eficientes energéticamente.
CPU_BOOST_ON_SAV=0

# HWP Dynamic Boost (NUEVO - IMPORTANTE)
# También deshabilitado para evitar cualquier pico innecesario de consumo.
# En modo ultra-ahorro, priorizamos duración sobre respuesta.
CPU_HWP_DYN_BOOST_ON_SAV=0

# ------------------------------------------------------------------------------
# Platform Profile: Mínimo Consumo
# ------------------------------------------------------------------------------

# "low-power" es el perfil más agresivo disponible en tu ThinkPad.
# Optimiza todo el SoC para mínimo consumo, incluyendo controladores
# de memoria, I/O, y otros subsistemas.
PLATFORM_PROFILE_ON_SAV=low-power

# ------------------------------------------------------------------------------
# Disco y Sistema de Archivos
# ------------------------------------------------------------------------------

# Laptop Mode
# Esperamos 5 segundos antes de sincronizar. Esto maximiza la agregación
# de escrituras y mantiene el disco dormido el mayor tiempo posible.
DISK_IDLE_SECS_ON_SAV=5

# Dirty pages
# Permitimos hasta 90 segundos de acumulación de cambios en memoria.
# Esto es agresivo, pero efectivo para mantener el disco en estado
# de bajo consumo.
MAX_LOST_WORK_SECS_ON_SAV=90

# ------------------------------------------------------------------------------
# Gráficos Intel Integrados
# ------------------------------------------------------------------------------

# En modo ultra-ahorro, podríamos limitar la GPU a frecuencias más bajas,
# pero los drivers modernos de Intel ya son muy eficientes.
#
# Si experimentas con limitar manualmente, ten en cuenta:
# - El mínimo del hardware es 800 MHz (no puedes ir más bajo)
# - Limitar a 800-1000 MHz puede causar stuttering en videos
# - Solo tiene sentido si NO estás viendo videos o usando apps gráficas
#
# Recomendación: Dejar sin configurar incluso en modo SAV
#
#INTEL_GPU_MIN_FREQ_ON_SAV=800
#INTEL_GPU_MAX_FREQ_ON_SAV=800
#INTEL_GPU_BOOST_FREQ_ON_SAV=800

# ------------------------------------------------------------------------------
# SATA y Almacenamiento
# ------------------------------------------------------------------------------

# Mantenemos la misma configuración que en modo BAT porque
# "med_power_with_dipm" ya es bastante agresivo.
SATA_LINKPWR_ON_SAV=med_power_with_dipm

# ------------------------------------------------------------------------------
# PCIe y Dispositivos del Sistema
# ------------------------------------------------------------------------------

# ASPM para PCIe
# Máximo ahorro de energía para todos los dispositivos PCIe.
PCIE_ASPM_ON_SAV=powersupersave

# Runtime Power Management
# Habilitado para todos los dispositivos. Esto maximiza el ahorro
# pero puede ocasionalmente causar latencias si un dispositivo tarda
# en despertar.
RUNTIME_PM_ON_SAV=auto

# ------------------------------------------------------------------------------
# Audio
# ------------------------------------------------------------------------------

# Audio power saving con timeout de 1 segundo.
SOUND_POWER_SAVE_ON_SAV=1
SOUND_POWER_SAVE_CONTROLLER=Y

# ------------------------------------------------------------------------------
# Wi-Fi
# ------------------------------------------------------------------------------

# Wi-Fi power saving habilitado. Puede añadir latencia notable
# (5-10ms adicionales), pero ahorra energía significativa.
WIFI_PWR_ON_SAV=on

# ------------------------------------------------------------------------------
# USB
# ------------------------------------------------------------------------------

# USB Autosuspend habilitado para todos los dispositivos compatibles.
USB_AUTOSUSPEND=1

# Mantenemos las mismas excepciones que en modo BAT
USB_EXCLUDE_AUDIO=1
USB_EXCLUDE_BTUSB=0
USB_EXCLUDE_PHONE=0
USB_EXCLUDE_PRINTER=1
USB_EXCLUDE_WWAN=0

# ------------------------------------------------------------------------------
# Dispositivos de Radio (Opcional pero Recomendado)
# ------------------------------------------------------------------------------

# Si realmente necesitas máxima duración de batería y no estás usando
# Bluetooth, puedes descomentar estas líneas para deshabilitarlo
# automáticamente cuando entres en modo power-saver.
#
# DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE="bluetooth"
#
# Esto solo deshabilitará Bluetooth si no hay dispositivos conectados.
# Si tienes auriculares o mouse Bluetooth activos, seguirán funcionando.

# ==============================================================================
# Notas sobre esta configuración:
# ==============================================================================
#
# ACTIVACIÓN MANUAL REQUERIDA
# Este perfil NO se activa automáticamente. Debes activarlo con:
#   sudo tlp power-saver
#
# Y volver al modo normal con:
#   sudo tlp start
#
# IMPACTO EN RENDIMIENTO
# Este perfil tendrá un impacto notable en el rendimiento:
#   - El sistema se sentirá más lento en general
#   - Las aplicaciones tardarán más en abrir
#   - La navegación web con muchas pestañas puede sentirse lenta
#   - La compilación de código será significativamente más lenta
#   - Video playback 4K puede tener problemas
#
# CONSUMO ESPERADO
# Con esta configuración, puedes esperar:
#   - CPU idle: ~2-4W (comparado con ~12W sin optimizar)
#   - Sistema completo idle: ~5-7W (comparado con ~16W sin optimizar)
#   - Duración de batería: potencialmente +100-150% comparado con defecto
#
# En términos prácticos, si normalmente obtienes 3 horas de batería con
# configuración por defecto, con este modo podrías obtener 6-8 horas
# en tareas ligeras (escritura, lectura, navegación básica).
#
# CUÁNDO USAR ESTE MODO
# Úsalo cuando:
#   ✓ Te queda poca batería y no tienes acceso a cargador pronto
#   ✓ Estás haciendo tareas ligeras (notas, lectura, escritura)
#   ✓ Necesitas que la batería dure lo máximo posible
#   ✓ Estás dispuesto a sacrificar rendimiento por duración
#
# NO uses este modo cuando:
#   ✗ Necesitas rendimiento (compilación, edición, gaming)
#   ✗ Estás haciendo videoconferencias (puede verse entrecortado)
#   ✗ Vas a conectar el cargador pronto de todas formas
#   ✗ El modo BAT normal ya te da duración suficiente
#
# COMBINACIONES ADICIONALES
# Para máxima duración, combina este modo con:
#   - Reducir brillo de pantalla al 30-40%
#   - Cerrar aplicaciones innecesarias en segundo plano
#   - Deshabilitar Bluetooth si no lo usas
#   - Usar modo oscuro (ahorra energía en pantallas OLED, menos relevante en LCD)
#
# TIPS PRÁCTICOS
# Puedes crear un alias en tu shell para activar este modo rápidamente:
#   alias power-save='sudo tlp power-saver && echo "Modo ultra-ahorro activado"'
#   alias power-normal='sudo tlp start && echo "Modo normal activado"'
#
# Agrégalos a tu ~/.bashrc o ~/.zshrc para tenerlos siempre disponibles.
#
# CHANGELOG v2.0:
# - Agregado CPU_HWP_DYN_BOOST_ON_SAV=0 (deshabilitar dynamic boost)
# - Mejorada documentación sobre limitaciones de GPU
# - Aclarado que AHCI_RUNTIME_PM_TIMEOUT es global (se define en archivo BAT)
# - Expandida sección de cuándo usar/no usar este modo
#
# ==============================================================================
