# ==============================================================================
# TLP Drop-in Configuration: Power-Saver Mode (Ultra Power Saving)
# ==============================================================================
# File: /etc/tlp.d/30-ultra-powersave.conf
# Purpose: Configuration for maximum battery life
# Version: 2.0 - Updated with complete parameters per TLP 1.9.1
# Last modified: 2026-02-16
# ==============================================================================
#
# This file defines the ultra-power-saver profile (SAV - power-saver).
# This profile is NOT activated automatically. You must invoke it manually
# when you need to squeeze every possible minute from your battery.
#
# To activate manually:
#   sudo tlp power-saver
#
# To return to automatic mode (AC/BAT depending on power source):
#   sudo tlp start
#
# Typical use cases:
#   - You're on a long flight without access to power
#   - You're in a long meeting and your battery is low
#   - You need the laptop to last as long as possible for a specific task
#   - You're working in "battery survival mode"
#
# ==============================================================================

# ------------------------------------------------------------------------------
# CPU: Maximum Power Saving
# ------------------------------------------------------------------------------

# Energy/Performance Policy (EPP)
# Use "power" which is the most aggressive power-saving policy. CPU will
# prefer minimum voltages and frequencies whenever possible. System will
# feel noticeably slower, but battery will last significantly longer.
CPU_ENERGY_PERF_POLICY_ON_SAV=power

# Performance limits
# Limit to 50% of maximum performance. This keeps CPU at low frequencies
# (typically 0.8-1.8 GHz) most of the time. System will be slower, but if
# you're only taking notes, reading documents, or writing, it will still
# be perfectly usable.
#
# Note: This was customized from the default 40% to 50% for slightly
# better responsiveness while still maintaining excellent battery life.
CPU_MIN_PERF_ON_SAV=0
CPU_MAX_PERF_ON_SAV=50

# Turbo Boost
# Completely disabled. Turbo boost is the number one enemy of battery life.
# Without it, CPU stays in its most energy-efficient frequencies.
CPU_BOOST_ON_SAV=0

# HWP Dynamic Boost (NEW - IMPORTANT)
# Also disabled to avoid any unnecessary consumption spikes.
# In ultra-power-saver mode, we prioritize duration over responsiveness.
CPU_HWP_DYN_BOOST_ON_SAV=0

# ------------------------------------------------------------------------------
# Platform Profile: Minimum Consumption
# ------------------------------------------------------------------------------

# "low-power" is the most aggressive profile available on your ThinkPad.
# Optimizes the entire SoC for minimum consumption, including memory
# controllers, I/O, and other subsystems.
PLATFORM_PROFILE_ON_SAV=low-power

# ------------------------------------------------------------------------------
# Disk and Filesystem
# ------------------------------------------------------------------------------

# Laptop Mode
# Wait 5 seconds before syncing. This maximizes write aggregation
# and keeps disk asleep as long as possible.
DISK_IDLE_SECS_ON_SAV=5

# Dirty pages
# Allow up to 90 seconds of change accumulation in memory.
# This is aggressive, but effective for keeping disk in low power state.
MAX_LOST_WORK_SECS_ON_SAV=90

# ------------------------------------------------------------------------------
# Intel Integrated Graphics
# ------------------------------------------------------------------------------

# In ultra-power-saver mode, we could limit GPU to lower frequencies,
# but modern Intel drivers are already very efficient.
#
# If experimenting with manual limits, keep in mind:
# - Hardware minimum is 800 MHz (can't go lower)
# - Limiting to 800-1000 MHz can cause stuttering in videos
# - Only makes sense if you're NOT watching videos or using graphics apps
#
# Recommendation: Leave unconfigured even in SAV mode
#
#INTEL_GPU_MIN_FREQ_ON_SAV=800
#INTEL_GPU_MAX_FREQ_ON_SAV=800
#INTEL_GPU_BOOST_FREQ_ON_SAV=800

# ------------------------------------------------------------------------------
# SATA and Storage
# ------------------------------------------------------------------------------

# Maintain same configuration as BAT mode because "med_power_with_dipm"
# is already quite aggressive.
SATA_LINKPWR_ON_SAV=med_power_with_dipm

# ------------------------------------------------------------------------------
# PCIe and System Devices
# ------------------------------------------------------------------------------

# ASPM for PCIe
# Maximum power saving for all PCIe devices.
PCIE_ASPM_ON_SAV=powersupersave

# Runtime Power Management
# Enabled for all devices. This maximizes savings but may occasionally
# cause latencies if a device takes time to wake up.
RUNTIME_PM_ON_SAV=auto

# ------------------------------------------------------------------------------
# Audio
# ------------------------------------------------------------------------------

# Audio power saving with 1 second timeout.
SOUND_POWER_SAVE_ON_SAV=1
SOUND_POWER_SAVE_CONTROLLER=Y

# ------------------------------------------------------------------------------
# Wi-Fi
# ------------------------------------------------------------------------------

# Wi-Fi power saving enabled. May add noticeable latency (5-10ms additional),
# but saves significant power.
WIFI_PWR_ON_SAV=on

# ------------------------------------------------------------------------------
# USB
# ------------------------------------------------------------------------------

# USB Autosuspend enabled for all compatible devices.
USB_AUTOSUSPEND=1

# Maintain same exceptions as BAT mode
USB_EXCLUDE_AUDIO=1
USB_EXCLUDE_BTUSB=0
USB_EXCLUDE_PHONE=0
USB_EXCLUDE_PRINTER=1
USB_EXCLUDE_WWAN=0

# ------------------------------------------------------------------------------
# Radio Devices (Optional but Recommended)
# ------------------------------------------------------------------------------

# If you really need maximum battery life and you're not using Bluetooth,
# you can uncomment these lines to automatically disable it when entering
# power-saver mode.
#
# DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE="bluetooth"
#
# This will only disable Bluetooth if no devices are connected.
# If you have Bluetooth headphones or mouse active, they'll keep working.

# ==============================================================================
# Notes about this configuration:
# ==============================================================================
#
# MANUAL ACTIVATION REQUIRED
# This profile is NOT activated automatically. You must activate it with:
#   sudo tlp power-saver
#
# And return to normal mode with:
#   sudo tlp start
#
# PERFORMANCE IMPACT
# This profile will have noticeable performance impact:
#   - System will feel slower overall
#   - Applications will take longer to open
#   - Web browsing with many tabs may feel sluggish
#   - Code compilation will be significantly slower
#   - 4K video playback may have issues
#
# EXPECTED POWER CONSUMPTION
# With this configuration, you can expect:
#   - CPU idle: ~2-4W (compared to ~12W without optimization)
#   - Complete system idle: ~5-7W (compared to ~16W without optimization)
#   - Battery life: potentially +100-150% compared to default
#
# In practical terms, if you normally get 3 hours of battery with default
# configuration, with this mode you could get 6-8 hours in light tasks
# (writing, reading, basic browsing).
#
# WHEN TO USE THIS MODE
# Use it when:
#   ✓ You're low on battery and won't have charger access soon
#   ✓ You're doing light tasks (notes, reading, writing)
#   ✓ You need battery to last as long as possible
#   ✓ You're willing to sacrifice performance for duration
#
# DON'T use this mode when:
#   ✗ You need performance (compilation, editing, gaming)
#   ✗ You're doing video conferencing (may appear choppy)
#   ✗ You'll connect charger soon anyway
#   ✗ Normal BAT mode already gives you sufficient duration
#
# ADDITIONAL COMBINATIONS
# For maximum duration, combine this mode with:
#   - Reduce screen brightness to 30-40%
#   - Close unnecessary background applications
#   - Disable Bluetooth if not in use
#   - Use dark mode (saves power on OLED screens, less relevant on LCD)
#
# PRACTICAL TIPS
# You can create a shell alias to activate this mode quickly:
#   alias power-save='sudo tlp power-saver && echo "Ultra power-saver activated"'
#   alias power-normal='sudo tlp start && echo "Normal mode activated"'
#
# Add them to your ~/.bashrc or ~/.zshrc to have them always available.
#
# CHANGELOG v2.0:
# - Added CPU_HWP_DYN_BOOST_ON_SAV=0 (disable dynamic boost)
# - Changed CPU_MAX_PERF_ON_SAV from 40 to 50 (custom user preference)
# - Improved documentation about GPU limitations
# - Clarified that AHCI_RUNTIME_PM_TIMEOUT is global (defined in BAT file)
# - Expanded section on when to use/not use this mode
#
# ==============================================================================
