# ==============================================================================
# TLP Drop-in Configuration: AC Power (Performance)
# ==============================================================================
# Archivo: /etc/tlp.d/10-ac-performance.conf
# Propósito: Configuración para máximo rendimiento cuando está conectado a AC
# Versión: 2.0 - Actualizada con parámetros completos según TLP 1.9.1
# Última modificación: 2026-02-16
# ==============================================================================
#
# Este archivo define el comportamiento del sistema cuando está conectado
# a corriente alterna (AC). El objetivo es aprovechar al máximo el hardware
# sin preocuparnos por el consumo de energía, ya que no estamos limitados
# por la batería.
#
# ==============================================================================

# ------------------------------------------------------------------------------
# CPU: Máximo Rendimiento
# ------------------------------------------------------------------------------

# Política de energía/rendimiento (EPP - Energy Performance Preference)
# "balance_performance" es ideal para AC: da buen rendimiento sin ser
# excesivamente agresivo. Si necesitas el máximo absoluto, puedes usar
# "performance", pero consume más energía sin beneficio notable en la
# mayoría de cargas de trabajo.
CPU_ENERGY_PERF_POLICY_ON_AC=balance_performance

# Límites de rendimiento del P-state
# 0% = mínimo permitido, 100% = máximo disponible
# En AC no limitamos el rendimiento, permitimos que el CPU use toda su
# capacidad cuando sea necesario.
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=100

# Turbo Boost
# Permitimos que el CPU use turbo boost en AC. El turbo boost permite
# que algunos cores superen su frecuencia base cuando hay margen térmico
# y el resto de cores están relativamente ociosos.
CPU_BOOST_ON_AC=1

# HWP Dynamic Boost (NUEVO - IMPORTANTE)
# Mejora la respuesta aumentando dinámicamente el P-state mínimo cuando
# una tarea que estaba esperando I/O es seleccionada para ejecutarse.
# Tu Intel Core Ultra 5 125U soporta esta característica.
# Mejora notablemente la respuesta en cargas interactivas.
CPU_HWP_DYN_BOOST_ON_AC=1

# ------------------------------------------------------------------------------
# Platform Profile: Rendimiento Balanceado
# ------------------------------------------------------------------------------

# El platform profile controla múltiples aspectos del sistema a nivel
# de firmware (no solo CPU, sino también controladores de I/O, memoria, etc.)
# "balanced" es el mejor compromiso para AC: buen rendimiento sin que
# el sistema se vuelva ruidoso o excesivamente caliente.
#
# Opciones disponibles en tu ThinkPad: performance, balanced, low-power
# Elegimos 'balanced' en lugar de 'performance' porque:
# - 'performance' hace que los ventiladores corran más fuerte
# - 'balanced' da excelente rendimiento sin ruido excesivo
# - Para trabajo normal, 'balanced' es más que suficiente
PLATFORM_PROFILE_ON_AC=balanced

# ------------------------------------------------------------------------------
# Disco y Sistema de Archivos
# ------------------------------------------------------------------------------

# Laptop Mode (segundos de espera antes de sincronizar el disco)
# 0 = deshabilitado, priorizamos respuesta sobre ahorro de energía
DISK_IDLE_SECS_ON_AC=0

# Dirty pages: cuánto tiempo puede la memoria retener cambios antes
# de escribirlos al disco. 15 segundos es el valor estándar del kernel.
MAX_LOST_WORK_SECS_ON_AC=15

# ------------------------------------------------------------------------------
# NVMe / SSD: Runtime Power Management (NUEVO - IMPORTANTE)
# ------------------------------------------------------------------------------

# Runtime PM para controladores AHCI/NVMe y discos
# En AC: 'on' = deshabilitado para mejor respuesta (sin latencia de wake-up)
# Tu ThinkPad tiene un NVMe SSD, este parámetro controla cuándo puede
# entrar en estados de bajo consumo.
AHCI_RUNTIME_PM_ON_AC=on

# ------------------------------------------------------------------------------
# Gráficos Intel Integrados
# ------------------------------------------------------------------------------

# Para la GPU Intel Arc (4-cores) integrada en tu Core Ultra 5 125U,
# el driver i915 hace un excelente trabajo de gestión automática.
# NO configuramos límites manuales - dejamos que el driver gestione
# las frecuencias (800-1850 MHz) según la carga.
#
# Solo descomenta si detectas consumo excesivo de GPU:
#INTEL_GPU_MIN_FREQ_ON_AC=800
#INTEL_GPU_MAX_FREQ_ON_AC=1850
#INTEL_GPU_BOOST_FREQ_ON_AC=1850

# ------------------------------------------------------------------------------
# SATA y Almacenamiento
# ------------------------------------------------------------------------------

# ALPM (Aggressive Link Power Management) para SATA
# Aunque tu laptop tiene NVMe, esto no causa problemas tenerlo configurado
# por si conectas discos SATA externos.
SATA_LINKPWR_ON_AC=med_power_with_dipm

# ------------------------------------------------------------------------------
# PCIe y Dispositivos del Sistema
# ------------------------------------------------------------------------------

# ASPM (Active State Power Management) para PCIe
# "default" mantiene lo que configuró la BIOS, que generalmente es
# lo más compatible y seguro.
PCIE_ASPM_ON_AC=default

# Runtime Power Management para dispositivos PCIe
# "on" = deshabilitado (mejor rendimiento, sin latencias)
# En AC deshabilitamos el ahorro de energía para dispositivos PCIe
# para evitar latencias adicionales.
RUNTIME_PM_ON_AC=on

# ------------------------------------------------------------------------------
# Audio
# ------------------------------------------------------------------------------

# Audio power saving
# Nota: Cambio importante vs versión anterior
# TLP recomienda '1' incluso en AC para sistemas con PulseAudio/PipeWire
# (que es lo que usas en Arch Linux). El valor '1' significa que el codec
# de audio entra en bajo consumo después de 1 segundo de silencio.
# Esto NO causa clics audibles en hardware moderno y ahorra energía mínima
# pero constante (~0.1W).
SOUND_POWER_SAVE_ON_AC=1
SOUND_POWER_SAVE_CONTROLLER=Y

# ------------------------------------------------------------------------------
# Wi-Fi
# ------------------------------------------------------------------------------

# Wi-Fi power saving
# "off" = deshabilitado. Priorizamos velocidad y latencia sobre ahorro.
WIFI_PWR_ON_AC=off

# ------------------------------------------------------------------------------
# Watchdog del Kernel (NUEVO - IMPORTANTE)
# ------------------------------------------------------------------------------

# NMI Watchdog: característica de debugging del kernel
# Cuando está habilitado, previene que la CPU entre en C-states profundos
# consumiendo energía innecesariamente.
# 0 = deshabilitado (recomendado para uso normal)
# 1 = habilitado (solo para debugging del kernel)
#
# Nota: Este es un parámetro global (no tiene variantes _AC/_BAT)
NMI_WATCHDOG=0

# ==============================================================================
# Notas sobre esta configuración:
# ==============================================================================
#
# Esta configuración está diseñada para dar el mejor rendimiento posible
# cuando estás conectado a AC, sin comprometer la estabilidad o generar
# calor/ruido excesivo. Es un perfil "balanceado-rendimiento" más que
# "rendimiento puro", porque la realidad es que para la mayoría de tareas
# (navegación, ofimática, desarrollo, multimedia) no necesitas que el CPU
# esté constantemente al máximo.
#
# Si trabajas con cargas realmente intensivas (renderizado 3D, compilación
# de proyectos grandes, edición de video 4K), puedes considerar cambiar:
#   - CPU_ENERGY_PERF_POLICY_ON_AC=performance
#   - PLATFORM_PROFILE_ON_AC=performance
#
# Sin embargo, ten en cuenta que esto hará que el sistema genere más calor
# y los ventiladores trabajen más fuerte.
#
# CHANGELOG v2.0:
# - Agregado CPU_HWP_DYN_BOOST_ON_AC=1 (importante para Core Ultra 5 125U)
# - Agregado AHCI_RUNTIME_PM_ON_AC=on (gestión de NVMe)
# - Agregado NMI_WATCHDOG=0 (deshabilitar watchdog)
# - Cambiado SOUND_POWER_SAVE_ON_AC de 0 a 1 (recomendación TLP)
# - Mejorada documentación sobre PLATFORM_PROFILE
# - Aclarada explicación sobre INTEL_GPU (dejar sin configurar)
#
# ==============================================================================
