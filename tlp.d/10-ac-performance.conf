# ==============================================================================
# TLP Drop-in Configuration: AC Power (Performance)
# ==============================================================================
# File: /etc/tlp.d/10-ac-performance.conf
# Purpose: Configuration for maximum performance when connected to AC power
# Version: 2.0 - Updated with complete parameters per TLP 1.9.1
# Last modified: 2026-02-16
# ==============================================================================
#
# This file defines system behavior when connected to AC power (wall outlet).
# The goal is to leverage hardware capabilities without worrying about power
# consumption, as we're not constrained by battery limitations.
#
# ==============================================================================

# ------------------------------------------------------------------------------
# CPU: Maximum Performance
# ------------------------------------------------------------------------------

# Energy/Performance Policy (EPP - Energy Performance Preference)
# "balance_performance" is ideal for AC: provides good performance without
# being overly aggressive. If you need absolute maximum, you can use
# "performance", but it consumes more power without noticeable benefit in
# most workloads.
CPU_ENERGY_PERF_POLICY_ON_AC=balance_performance

# P-state performance limits
# 0% = minimum allowed, 100% = maximum available
# On AC we don't limit performance, allowing CPU to use full capacity
# when needed.
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=100

# Turbo Boost
# Allow CPU to use turbo boost on AC. Turbo boost allows some cores to
# exceed their base frequency when there's thermal headroom and other
# cores are relatively idle.
CPU_BOOST_ON_AC=1

# HWP Dynamic Boost (NEW - IMPORTANT)
# Improves responsiveness by dynamically raising minimum P-state when
# a task previously waiting on I/O becomes runnable.
# Your Intel Core Ultra 5 125U supports this feature.
# Noticeably improves response in interactive workloads.
CPU_HWP_DYN_BOOST_ON_AC=1

# ------------------------------------------------------------------------------
# Platform Profile: Balanced Performance
# ------------------------------------------------------------------------------

# Platform profile controls multiple system aspects at firmware level
# (not just CPU, but also I/O controllers, memory, etc.)
# "balanced" is the best compromise for AC: good performance without
# making the system noisy or excessively hot.
#
# Available options on your ThinkPad: performance, balanced, low-power
# We choose 'balanced' instead of 'performance' because:
# - 'performance' makes fans run louder
# - 'balanced' provides excellent performance without excessive noise
# - For normal work, 'balanced' is more than sufficient
PLATFORM_PROFILE_ON_AC=balanced

# ------------------------------------------------------------------------------
# Disk and Filesystem
# ------------------------------------------------------------------------------

# Laptop Mode (seconds to wait before syncing disk)
# 0 = disabled, we prioritize responsiveness over power saving
DISK_IDLE_SECS_ON_AC=0

# Dirty pages: how long memory can hold changes before writing to disk
# 15 seconds is the standard kernel value
MAX_LOST_WORK_SECS_ON_AC=15

# ------------------------------------------------------------------------------
# NVMe / SSD: Runtime Power Management (NEW - IMPORTANT)
# ------------------------------------------------------------------------------

# Runtime PM for AHCI/NVMe controllers and disks
# On AC: 'on' = disabled for better responsiveness (no wake-up latency)
# Your ThinkPad has an NVMe SSD, this parameter controls when it can
# enter low power states.
AHCI_RUNTIME_PM_ON_AC=on

# ------------------------------------------------------------------------------
# Intel Integrated Graphics
# ------------------------------------------------------------------------------

# For the Intel Arc Graphics (4-cores) integrated in your Core Ultra 5 125U,
# the i915 driver does an excellent job with automatic management.
# We DO NOT configure manual limits - let the driver manage frequencies
# (800-1850 MHz) based on load.
#
# Only uncomment if you detect excessive GPU power consumption:
#INTEL_GPU_MIN_FREQ_ON_AC=800
#INTEL_GPU_MAX_FREQ_ON_AC=1850
#INTEL_GPU_BOOST_FREQ_ON_AC=1850

# ------------------------------------------------------------------------------
# SATA and Storage
# ------------------------------------------------------------------------------

# ALPM (Aggressive Link Power Management) for SATA
# Although your laptop has NVMe, having this configured doesn't cause issues
# in case you connect external SATA disks.
SATA_LINKPWR_ON_AC=med_power_with_dipm

# ------------------------------------------------------------------------------
# PCIe and System Devices
# ------------------------------------------------------------------------------

# ASPM (Active State Power Management) for PCIe
# "default" maintains what BIOS configured, which is generally
# the most compatible and safe option.
PCIE_ASPM_ON_AC=default

# Runtime Power Management for PCIe devices
# "on" = disabled (better performance, no latencies)
# On AC we disable power saving for PCIe devices to avoid additional latencies.
RUNTIME_PM_ON_AC=on

# ------------------------------------------------------------------------------
# Audio
# ------------------------------------------------------------------------------

# Audio power saving
# Note: Important change from previous version
# TLP recommends '1' even on AC for systems with PulseAudio/PipeWire
# (which you're using on Arch Linux). Value of '1' means audio codec
# enters low power state after 1 second of silence.
# This does NOT cause audible clicks on modern hardware and saves minimal
# but constant power (~0.1W).
SOUND_POWER_SAVE_ON_AC=1
SOUND_POWER_SAVE_CONTROLLER=Y

# ------------------------------------------------------------------------------
# Wi-Fi
# ------------------------------------------------------------------------------

# Wi-Fi power saving
# "off" = disabled. We prioritize speed and latency over savings.
WIFI_PWR_ON_AC=off

# ------------------------------------------------------------------------------
# Kernel Watchdog (NEW - IMPORTANT)
# ------------------------------------------------------------------------------

# NMI Watchdog: kernel debugging feature
# When enabled, prevents CPU from entering deep C-states,
# consuming power unnecessarily.
# 0 = disabled (recommended for normal use)
# 1 = enabled (only for kernel debugging)
#
# Note: This is a global parameter (no _AC/_BAT variants)
NMI_WATCHDOG=0

# ==============================================================================
# Notes about this configuration:
# ==============================================================================
#
# This configuration is designed to provide the best possible performance
# when connected to AC, without compromising stability or generating
# excessive heat/noise. It's a "balanced-performance" profile rather than
# "pure performance", because for most tasks (browsing, office work,
# development, multimedia) you don't need CPU constantly at maximum.
#
# If you work with truly intensive loads (3D rendering, large project
# compilation, 4K video editing), you might consider changing:
#   - CPU_ENERGY_PERF_POLICY_ON_AC=performance
#   - PLATFORM_PROFILE_ON_AC=performance
#
# However, note this will make the system generate more heat and
# fans will work harder.
#
# CHANGELOG v2.0:
# - Added CPU_HWP_DYN_BOOST_ON_AC=1 (important for Core Ultra 5 125U)
# - Added AHCI_RUNTIME_PM_ON_AC=on (NVMe management)
# - Added NMI_WATCHDOG=0 (disable watchdog)
# - Changed SOUND_POWER_SAVE_ON_AC from 0 to 1 (TLP recommendation)
# - Improved PLATFORM_PROFILE documentation
# - Clarified INTEL_GPU explanation (leave unconfigured)
#
# ==============================================================================
