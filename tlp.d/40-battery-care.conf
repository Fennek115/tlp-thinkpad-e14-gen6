# ==============================================================================
# TLP Drop-in Configuration: Battery Care (Battery Health Management)
# ==============================================================================
# File: /etc/tlp.d/40-battery-care.conf
# Purpose: Configuration of charge thresholds to extend battery lifespan
# Last modified: 2026-02-16
# ==============================================================================
#
# This file configures charge thresholds for your ThinkPad battery.
# Limiting maximum charge significantly extends the lifespan of lithium-ion
# batteries.
#
# IMPORTANT: These settings apply to ALL modes (AC, BAT, SAV) because they
# are hardware battery settings, not power consumption settings.
#
# ==============================================================================

# ------------------------------------------------------------------------------
# Explanation: Why limit charge?
# ------------------------------------------------------------------------------
#
# Lithium-ion batteries degrade faster when constantly kept at 100% charge,
# especially when also exposed to high temperatures. Battery chemistry
# suffers more stress at the extremes of the charge range (very low or
# very high).
#
# By limiting maximum charge to 80% and starting to charge only when it
# drops below 75%, you reduce battery stress and can extend its lifespan
# from ~500 cycles to potentially ~1000-1500 cycles.
#
# TRADE-OFF: You sacrifice 20% immediate capacity (from 100% to 80%) but
# in exchange your battery maintains its effective capacity for much longer.
#
# Simple math:
#   - Without limits: 100% capacity for 2-3 years, then rapid degradation
#   - With 75-80% limits: 80% capacity for 4-6 years with slow degradation
#
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Threshold Configuration for BAT0 (Main Battery)
# ------------------------------------------------------------------------------

# Start charge threshold (START_CHARGE_THRESH)
# Charging will begin when battery level drops BELOW this value
# and charger is connected.
START_CHARGE_THRESH_BAT0=75

# Stop charge threshold (STOP_CHARGE_THRESH)
# Charging will stop when battery level reaches or exceeds this value.
STOP_CHARGE_THRESH_BAT0=80

# ------------------------------------------------------------------------------
# Explanation of chosen values (75-80%)
# ------------------------------------------------------------------------------
#
# Range 75-80%: This is a good compromise recommended for most users.
# It gives you a 5% charge/discharge window (sufficient to avoid excessive
# cycles) while maintaining a good 80% available capacity.
#
# ALTERNATIVES depending on your use case:
#
# Option 1: Maximum longevity (60-70%)
#   START_CHARGE_THRESH_BAT0=60
#   STOP_CHARGE_THRESH_BAT0=70
#   Pro: Maximum battery lifespan (potentially 2000+ cycles)
#   Con: Only 70% capacity available
#   When: If you almost always work connected to AC and rarely need
#         full battery capacity
#
# Option 2: Standard balance (75-80%) ← CURRENT
#   START_CHARGE_THRESH_BAT0=75
#   STOP_CHARGE_THRESH_BAT0=80
#   Pro: Good balance between longevity and available capacity
#   Con: None significant
#   When: For most users who work partially connected and partially
#         on battery
#
# Option 3: Maximum capacity (90-100%)
#   START_CHARGE_THRESH_BAT0=90
#   STOP_CHARGE_THRESH_BAT0=100
#   Pro: You have full battery capacity available
#   Con: Reduced battery lifespan (~500-800 cycles)
#   When: If you frequently need full battery capacity and plan to
#         replace the laptop in 2-3 years anyway
#
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Threshold restoration on AC disconnect
# ------------------------------------------------------------------------------

# Some ThinkPads reset thresholds when you disconnect AC. This setting
# restores them automatically when you unplug the charger. Generally not
# necessary on modern ThinkPads, but doesn't hurt to have it.
#RESTORE_THRESHOLDS_ON_BAT=1

# ------------------------------------------------------------------------------
# Secondary Battery (BAT1)
# ------------------------------------------------------------------------------
#
# Your ThinkPad E14 Gen 6 has a single internal battery, so these settings
# are commented out. If in the future you add an external or slice battery,
# you can uncomment and configure these values.
#
#START_CHARGE_THRESH_BAT1=75
#STOP_CHARGE_THRESH_BAT1=80

# ==============================================================================
# Configuration Verification
# ==============================================================================
#
# To verify thresholds are correctly applied:
#
#   sudo tlp-stat -b
#
# You should see something like:
#
#   /sys/class/power_supply/BAT0/charge_control_start_threshold =  75 [%]
#   /sys/class/power_supply/BAT0/charge_control_end_threshold   =  80 [%]
#
# If you see "not available", it means either your hardware doesn't support
# this function (unlikely on a modern ThinkPad) or the kernel module is not
# loaded correctly.
#
# ==============================================================================
#
# IMPORTANT NOTE: Charging Behavior
# ==============================================================================
#
# With this configuration:
#
# 1. If you connect charger with battery at 90%:
#    → Nothing happens, battery stays at 90% (already above 80%)
#    → System powers directly from AC
#
# 2. If you connect charger with battery at 70%:
#    → Battery starts charging (below 75%)
#    → Stops when reaching 80%
#
# 3. If you disconnect charger with battery at 80%:
#    → Battery begins discharging normally
#    → If you reconnect before reaching 75%, it won't charge
#
# This is NORMAL and is the desired behavior. It's not a bug.
# The idea is to avoid unnecessary charge cycles when you're connected
# to AC most of the time.
#
# ==============================================================================
#
# TEMPORARY FULL CHARGE OVERRIDE
# ==============================================================================
#
# If you need to charge to 100% once (e.g., before a long trip):
#
#   sudo tlp fullcharge BAT0
#
# This will temporarily bypass thresholds and charge to 100%. After reaching
# 100%, thresholds automatically restore for subsequent charges.
#
# ==============================================================================
